#!/usr/bin/env bash

#
# Do not edit this file, it will be overwritten by the e2e-data-update.sh script.
# Contibution are welcomed at https://github.com/jooola/test-data
#

set -u

# Constants
source_repo="https://github.com/jooola/test-data"
source_branch="master"
source_paths=(
  "e2e-data"
  "e2e-data-update.sh"
  "docker-compose.yml"
)

error() {
  echo >&2 "$*"
  exit 1
}

typeset -r tmp_dir="tmp-$(date +%s)"
typeset -r cmd_git=$(/usr/bin/which git) && [[ -x $cmd_git ]] || error "git command not found!"

echo "Cloning temporary source repository"
$cmd_git clone --depth=1 $source_repo $tmp_dir -q

echo "Updating data from source repository"
for source_path in ${source_paths[@]}; do
  if [[ -d "$tmp_dir/${source_path}" ]]; then
    cp -r "$tmp_dir/${source_path}/" $(dirname "./${source_path}/")
  else
    cp "$tmp_dir/${source_path}" "./${source_path}"
  fi
done

echo "Removing temporary source repository"
rm -Rf $tmp_dir
